---
import TimelineLayout from "../../layouts/TimelineLayout.astro";
import { getCollection } from "astro:content";
import { getExcerpt } from "../../utils/markdown";

// Use getCollection and filter for index.md - more reliable than getEntry
const allUsesEntries = await getCollection("uses");
const entry = allUsesEntries.find((e) => e.id === "index.md");

if (!entry) {
  throw new Error("Could not find index.md in src/content/uses/");
}

const { Content } = await entry.render();

// Get all uses entries, exclude index.md (landing page)
const allEntries = allUsesEntries.filter((e) => e.id !== "index.md");

// Transform entries for the timeline
const entries = allEntries.map((entry) => {
  const rawDate = entry.data.date;
  const date = rawDate instanceof Date ? rawDate : new Date(rawDate);

  return {
    slug: entry.slug,
    title: entry.data.title,
    date: date,
    excerpt:
      entry.data.excerpt || entry.data.description || getExcerpt(entry.body),
    href: `/uses/${entry.slug}`,
    coverImage: entry.data["cover-image"],
  };
});
---

<TimelineLayout
  title={entry.data.title || "Uses"}
  description={entry.data.description || "Tools and setup"}
  entries={entries}
  basePath="/uses"
>
  <p>{entry.data.description}</p>
</TimelineLayout>

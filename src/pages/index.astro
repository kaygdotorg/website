---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getEntry, getCollection } from "astro:content";
import { formatDateWithComma } from "../utils/dates";

// Load content from home.md
const homeEntry = await getEntry("pages", "home");

if (!homeEntry) {
  throw new Error("Could not find home.md in src/content/pages/");
}

// Fetch entries from now and uses collections to get latest dates
const nowEntries = await getCollection("now");
const usesEntries = await getCollection("uses");

// Sort to get latest entries
const latestNow = nowEntries.sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime(),
)[0];
const latestUses = usesEntries.sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime(),
)[0];

// Extract data from frontmatter
const { name, tagline, profileImage, email, quote } = homeEntry.data;

// Bento grid items
const bentoItems = [
  {
    title: "Now",
    subtitle:
      "What I'm currently focused on â€” the projects, ideas, and activities occupying my mind.",
    href: "/now",
    image:
      "https://images.unsplash.com/photo-1499750310107-5fef28a66643?w=800&q=80",
    size: "normal",
    date: latestNow ? formatDateWithComma(latestNow.data.date) : null,
  },
  {
    title: "Uses",
    subtitle: "The tools, software, and gear that power my daily workflow.",
    href: "/uses",
    image:
      "https://images.unsplash.com/photo-1483058712412-4245e9b90334?w=800&q=80",
    size: "normal",
    date: latestUses ? formatDateWithComma(latestUses.data.date) : null,
  },
  {
    title: "Photography",
    subtitle: "Moments captured through my lens.",
    href: "/photography",
    image:
      "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&q=80",
    size: "wide",
  },
  {
    title: "Writing",
    subtitle: "Thoughts on technology, creativity, and life.",
    href: "/writing",
    image:
      "https://images.unsplash.com/photo-1455390582262-044cdead277a?w=800&q=80",
    size: "normal",
  },
];
---

<BaseLayout title="Home" description="Personal website and digital garden">
  <div class="bento-container">
    <!-- Sparkles background -->
    <div class="sparkles-container" aria-hidden="true">
      <div class="sparkle"></div>
      <div class="sparkle"></div>
      <div class="sparkle"></div>
      <div class="sparkle"></div>
      <div class="sparkle"></div>
    </div>

    <div class="bento-grid">
      <!-- Hero Cell - Profile -->
      <a
        href="#about"
        class="bento-cell bento-hero grainy-card glow-hover gradient-border animate-fade-up"
      >
        <div class="bento-content">
          <div class="hero-top">
            {
              profileImage && (
                <div class="profile-card">
                  <div class="profile-image-wrapper">
                    <img
                      src={profileImage}
                      alt={`${name} photo`}
                      class="w-24 h-24 md:w-32 md:h-32 object-cover rounded-full"
                      fetchpriority="high"
                    />
                  </div>
                </div>
              )
            }
          </div>
          <div class="hero-bottom">
            <h1 class="bento-title gradient-text">{name}</h1>
            <p class="bento-subtitle">{tagline}</p>
          </div>
        </div>
      </a>

      <!-- Now Cell -->
      <a
        href={bentoItems[0].href}
        class="bento-cell bento-image grainy-card glow-hover animate-fade-up stagger-1"
        style={`background-image: url('${bentoItems[0].image}')`}
      >
        <div class="bento-content">
          <div>
            <h2 class="bento-title">{bentoItems[0].title}</h2>
            {
              bentoItems[0].date && (
                <p class="text-xs opacity-60 mt-1">
                  Updated {bentoItems[0].date}
                </p>
              )
            }
          </div>
          <div class="bento-arrow">
            <span>explore</span>
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
            </svg>
          </div>
        </div>
      </a>

      <!-- Uses Cell -->
      <a
        href={bentoItems[1].href}
        class="bento-cell bento-image grainy-card glow-hover animate-fade-up stagger-2"
        style={`background-image: url('${bentoItems[1].image}')`}
      >
        <div class="bento-content">
          <div>
            <h2 class="bento-title">{bentoItems[1].title}</h2>
            {
              bentoItems[1].date && (
                <p class="text-xs opacity-60 mt-1">
                  Updated {bentoItems[1].date}
                </p>
              )
            }
          </div>
          <div class="bento-arrow">
            <span>explore</span>
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
            </svg>
          </div>
        </div>
      </a>

      <!-- Photography Cell (wide) -->
      <a
        href={bentoItems[2].href}
        class="bento-cell bento-wide bento-image grainy-card glow-hover animate-fade-up stagger-3"
        style={`background-image: url('${bentoItems[2].image}')`}
      >
        <div class="bento-content">
          <div>
            <h2 class="bento-title">{bentoItems[2].title}</h2>
            <p class="bento-subtitle hidden md:block">
              {bentoItems[2].subtitle}
            </p>
          </div>
          <div class="bento-arrow">
            <span>view gallery</span>
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
            </svg>
          </div>
        </div>
      </a>

      <!-- Writing Cell -->
      <a
        href={bentoItems[3].href}
        class="bento-cell bento-image grainy-card glow-hover animate-fade-up stagger-4"
        style={`background-image: url('${bentoItems[3].image}')`}
      >
        <div class="bento-content">
          <div>
            <h2 class="bento-title">{bentoItems[3].title}</h2>
          </div>
          <div class="bento-arrow">
            <span>read</span>
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
            </svg>
          </div>
        </div>
      </a>

      <!-- Quote Cell -->
      <a
        href={`mailto:${email}`}
        class="bento-cell grainy-card glow-hover animate-fade-up stagger-5"
      >
        <div class="bento-content quote-cell">
          <blockquote
            class="text-lg md:text-xl italic opacity-80 leading-relaxed"
          >
            "{quote}"
          </blockquote>
          <div class="bento-arrow mt-4">
            <span>get in touch</span>
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
            </svg>
          </div>
        </div>
      </a>
    </div>
  </div>

  <style>
    .bento-container {
      min-height: 100vh;
      padding: 2rem 0;
      position: relative;
    }

    @media (min-width: 768px) {
      .bento-container {
        padding: 4rem 0;
        display: flex;
        align-items: center;
      }
    }

    .sparkles-container {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 1;
    }

    .hero-top {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hero-bottom {
      text-align: center;
    }

    .hero-bottom .bento-title {
      font-size: 2rem;
      margin-bottom: 0.75rem;
    }

    @media (min-width: 768px) {
      .hero-bottom .bento-title {
        font-size: 2.75rem;
      }
    }

    .quote-cell {
      display: flex;
      flex-direction: column;
      justify-content: center;
      text-align: center;
    }

    .quote-cell .bento-arrow {
      justify-content: center;
    }

    /* Ensure bento cells have proper min-height on mobile */
    @media (max-width: 639px) {
      .bento-cell {
        min-height: 180px;
      }

      .bento-cell.bento-hero {
        min-height: 320px;
      }
    }
  </style>
</BaseLayout>

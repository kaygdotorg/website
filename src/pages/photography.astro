---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

// Use getCollection and filter for index.md - more reliable than getEntry
const allEntries = await getCollection("photography");
const entry = allEntries.find((e) => e.id === "index.md");

if (!entry) {
  throw new Error("Could not find index.md in src/content/photography/");
}

const { Content } = await entry.render();

// Photos with more variety for the gallery
const photos = [
  {
    src: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1200&q=80",
    thumb:
      "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=600&q=80",
    alt: "Mountain landscape at golden hour",
    category: "Landscape",
    location: "Swiss Alps",
  },
  {
    src: "https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?w=1200&q=80",
    thumb:
      "https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?w=600&q=80",
    alt: "City skyline at dusk",
    category: "Urban",
    location: "New York",
  },
  {
    src: "https://images.unsplash.com/photo-1494500764479-0c8f2919a3d8?w=1200&q=80",
    thumb:
      "https://images.unsplash.com/photo-1494500764479-0c8f2919a3d8?w=600&q=80",
    alt: "Night sky with stars",
    category: "Landscape",
    location: "Death Valley",
  },
  {
    src: "https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1200&q=80",
    thumb:
      "https://images.unsplash.com/photo-1519681393784-d120267933ba?w=600&q=80",
    alt: "Snowy mountain peak",
    category: "Landscape",
    location: "Mont Blanc",
  },
  {
    src: "https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?w=1200&q=80",
    thumb:
      "https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?w=600&q=80",
    alt: "City streets at night",
    category: "Urban",
    location: "Tokyo",
  },
  {
    src: "https://images.unsplash.com/photo-1444464666168-49d633b86797?w=1200&q=80",
    thumb:
      "https://images.unsplash.com/photo-1444464666168-49d633b86797?w=600&q=80",
    alt: "Bird in flight over ocean",
    category: "Nature",
    location: "California Coast",
  },
  {
    src: "https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=1200&q=80",
    thumb:
      "https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=600&q=80",
    alt: "Misty forest sunrise",
    category: "Landscape",
    location: "Pacific Northwest",
  },
  {
    src: "https://images.unsplash.com/photo-1449824913935-59a10b8d2000?w=1200&q=80",
    thumb:
      "https://images.unsplash.com/photo-1449824913935-59a10b8d2000?w=600&q=80",
    alt: "Urban architecture",
    category: "Urban",
    location: "London",
  },
  {
    src: "https://images.unsplash.com/photo-1472214103451-9374bd1c798e?w=1200&q=80",
    thumb:
      "https://images.unsplash.com/photo-1472214103451-9374bd1c798e?w=600&q=80",
    alt: "Rolling green hills",
    category: "Landscape",
    location: "Tuscany",
  },
];

const categories = [...new Set(photos.map((p) => p.category))];
const isInProgress = entry.data["display-in-progress"] === true;
---

<BaseLayout
  title={entry.data.title}
  description={entry.data.description}
  displayInProgress={isInProgress}
>
  <section class="max-w-6xl mx-auto px-4 md:px-6 py-12 md:py-24">
    <!-- Header -->
    <header class="mb-12 max-w-2xl animate-fade-up">
      <h1 class="font-display text-4xl md:text-5xl mb-4 gradient-text">
        {entry.data.title}
      </h1>
      <p class="text-base-content/70 text-lg leading-relaxed">
        {entry.data.description}
      </p>
    </header>

    <!-- Category Filters -->
    <div class="flex flex-wrap gap-2 mb-8 animate-fade-up stagger-1">
      <button
        class="filter-btn active px-4 py-2 rounded-full text-sm transition-all"
        data-category="all"
      >
        All
      </button>
      {
        categories.map((category) => (
          <button
            class="filter-btn px-4 py-2 rounded-full text-sm transition-all"
            data-category={category}
          >
            {category}
          </button>
        ))
      }
    </div>

    <!-- Photo Gallery -->
    <div class="photo-gallery animate-fade-up stagger-2">
      {
        photos.map((photo, index) => (
          <div
            class="photo-item frosted-card"
            data-category={photo.category}
            data-src={photo.src}
            data-alt={photo.alt}
            style={`animation-delay: ${index * 0.1}s`}
          >
            <img src={photo.thumb} alt={photo.alt} loading="lazy" />
            <div class="photo-overlay">
              <p class="font-medium text-lg">{photo.alt}</p>
              <p class="text-sm opacity-70 mt-1">
                {photo.location} Â· {photo.category}
              </p>
            </div>
          </div>
        ))
      }
    </div>

    <!-- Note about replacing photos -->
    <div class="mt-16 p-6 rounded-2xl frosted-card animate-fade-up stagger-3">
      <p class="text-base-content/70 text-sm text-center">
        <strong class="text-accent">Note:</strong> These are placeholder images from
        Unsplash. Replace them with your own photos by updating the paths in this
        file.
      </p>
    </div>
  </section>

  <style>
    .filter-btn {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: var(--fallback-bc, #f8f4fc);
      opacity: 0.7;
    }

    .filter-btn:hover,
    .filter-btn.active {
      background: rgba(244, 114, 182, 0.15);
      border-color: rgba(244, 114, 182, 0.3);
      color: var(--color-accent-500, #ec4899);
      opacity: 1;
    }

    [data-theme="light"] .filter-btn {
      background: rgba(0, 0, 0, 0.03);
      border-color: rgba(0, 0, 0, 0.1);
      color: #1a1225;
    }

    [data-theme="light"] .filter-btn:hover,
    [data-theme="light"] .filter-btn.active {
      background: rgba(236, 72, 153, 0.1);
      border-color: rgba(236, 72, 153, 0.3);
      color: var(--color-accent-600, #db2777);
      opacity: 1;
    }

    .photo-item.hidden {
      display: none;
    }
  </style>

  <script>
    // Initialize photography gallery filters
    function initPhotographyFilters() {
      const filterBtns = document.querySelectorAll(".filter-btn");
      const photoItems = document.querySelectorAll(".photo-item");

      // Only add listeners if not already initialized
      filterBtns.forEach((btn) => {
        if ((btn as any).__filterInitialized) return;
        (btn as any).__filterInitialized = true;

        btn.addEventListener("click", () => {
          filterBtns.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");

          const category = btn.getAttribute("data-category");

          photoItems.forEach((item) => {
            if (
              category === "all" ||
              item.getAttribute("data-category") === category
            ) {
              item.classList.remove("hidden");
            } else {
              item.classList.add("hidden");
            }
          });
        });
      });
    }

    // Run on initial load
    initPhotographyFilters();

    // Also run on view transitions
    document.addEventListener("astro:page-load", initPhotographyFilters);
  </script>
</BaseLayout>
